<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --teal: #0ff2b2;
            --bright-pink: #f20fb2;
            --dark-blue: #3850d4;
            --dark-gray: #545454;
            --bg-dark: #1a1a1a; /* A darker gray for the background */
            --card-dark: #2a2a2a; /* A lighter dark for cards */
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-dark);
            color: #e0e0e0;
        }

        .loader {
            border: 4px solid #444;
            border-top: 4px solid var(--bright-pink);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ad-button {
            transition: all 0.2s ease-in-out;
            background-color: var(--dark-blue);
            border: 1px solid var(--dark-blue);
            color: white;
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
        }

        .ad-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 15px 0px var(--teal);
            background-color: var(--teal);
            border-color: var(--teal);
            color: var(--bg-dark);
            text-shadow: none;
        }
        
        .futuristic-card {
            background-color: var(--card-dark);
            border: 1px solid #444;
            box-shadow: 0 0 25px -5px rgba(0,0,0,0.5);
        }

        .gradient-text {
            background: linear-gradient(90deg, var(--teal), var(--bright-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .upload-area-futuristic {
             border-color: #444;
             transition: all 0.3s ease;
        }

        .upload-area-futuristic:hover {
            border-color: var(--teal);
            box-shadow: inset 0 0 10px 0 var(--teal);
        }

        .download-btn-futuristic {
            background-color: var(--bright-pink);
        }

        .download-btn-futuristic:hover {
            box-shadow: 0 0 15px 0px var(--bright-pink);
        }

    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-5xl md:text-6xl font-black gradient-text tracking-wide">AD STUDIO AI</h1>
            <p class="text-lg text-gray-400 mt-2">Crafting the future of advertising with your product.</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Left Column: Upload & Source Image -->
            <div class="futuristic-card p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 border-b-2 border-gray-600 pb-2 text-gray-200">1. UPLOAD PRODUCT IMAGE</h2>
                <div class="upload-area-futuristic border-2 border-dashed rounded-lg p-6 text-center cursor-pointer" id="upload-area">
                    <input type="file" id="image-upload" class="hidden" accept="image/*">
                    <svg class="mx-auto h-12 w-12 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M7 16a4 4 0 01-4-4V6a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243m11.314-5.657a4 4 0 010 5.656L12 18.5a4 4 0 01-5.657-5.657l1.414-1.414" />
                    </svg>
                    <p class="mt-2 text-sm text-gray-400">
                        <span class="font-medium" style="color: var(--teal);">Click to upload</span> or drag and drop
                    </p>
                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, GIF up to 10MB</p>
                </div>

                <div id="source-image-container" class="mt-6 hidden">
                    <h3 class="text-xl font-medium mb-2 text-gray-300">Source Image</h3>
                    <img id="source-image" src="" alt="Uploaded Product" class="rounded-lg w-full h-auto object-contain max-h-96 border border-gray-700">
                </div>
            </div>

            <!-- Right Column: Ad Generation & Result -->
            <div class="futuristic-card p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 border-b-2 border-gray-600 pb-2 text-gray-200">2. SELECT AD FORMAT</h2>
                <div id="ad-formats" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                    <!-- Ad format buttons will be injected here -->
                </div>

                 <div id="result-container" class="mt-6 hidden">
                    <h3 class="text-xl font-medium mb-2 text-gray-300">Generated Ad</h3>
                     <div id="loader" class="flex justify-center items-center h-64">
                         <div class="loader"></div>
                     </div>
                    <div id="image-result-wrapper" class="hidden">
                         <img id="generated-image" src="" alt="Generated Ad" class="rounded-lg w-full h-auto object-contain max-h-[500px] border border-gray-700">
                         <button id="download-btn" class="mt-4 w-full download-btn-futuristic ad-button text-white font-bold py-3 px-4 rounded-lg">Download Ad</button>
                    </div>
                     <div id="error-message" class="hidden text-center text-red-400 bg-red-900 bg-opacity-50 p-4 rounded-lg border border-red-500"></div>
                </div>
                 <div id="placeholder-text" class="mt-6 text-center text-gray-500 py-10">
                    <p>Your generated ad will appear here.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        const uploadArea = document.getElementById('upload-area');
        const imageUpload = document.getElementById('image-upload');
        const sourceImageContainer = document.getElementById('source-image-container');
        const sourceImage = document.getElementById('source-image');
        const adFormatsContainer = document.getElementById('ad-formats');
        const resultContainer = document.getElementById('result-container');
        const loader = document.getElementById('loader');
        const generatedImage = document.getElementById('generated-image');
        const imageResultWrapper = document.getElementById('image-result-wrapper');
        const placeholderText = document.getElementById('placeholder-text');
        const errorMessage = document.getElementById('error-message');
        const downloadBtn = document.getElementById('download-btn');

        let uploadedImageBase64 = null;
        let uploadedImageType = null;

        const adIdeas = [
            { name: "Facebook Feed", prompt: "Create a vibrant and engaging Facebook feed ad. The product should be in a realistic lifestyle setting. Include a 'Shop Now' button overlay. Aspect ratio 1:1." },
            { name: "Instagram Story", prompt: "Generate an eye-catching Instagram Story. Use a vertical 9:16 aspect ratio. The product should be the hero. Add trendy graphics and a 'Swipe Up' sticker." },
            { name: "Google Banner", prompt: "Design a professional Google Display Ad banner (728x90). The product must be on a clean, gradient background with a clear call-to-action and company logo placeholder." },
            { name: "LinkedIn Ad", prompt: "Produce a sophisticated LinkedIn sponsored post. The product should be shown in a professional, modern office or business environment. The tone should be corporate and trustworthy." },
            { name: "Pinterest Pin", prompt: "Create an aesthetic Pinterest Pin ad. The image should be aspirational and visually pleasing, with a text overlay describing a key benefit of the product. Vertical format." },
            { name: "Twitter/X Post", prompt: "Make a bold and punchy Twitter/X ad. Use high-contrast colors. The product should be in action or its most dynamic state. Keep it simple and direct." },
            { name: "E-commerce Showcase", prompt: "Generate a clean product showcase image for an e-commerce website. The product should be on a pure white or very light grey background, with soft, natural shadows." },
            { name: "Email Banner", prompt: "Design a wide, visually appealing banner for an email marketing campaign. The product should be part of a thematic composition (e.g., seasonal, holiday). " },
            { name: "YouTube Thumbnail", prompt: "Create a clickable YouTube video thumbnail (16:9 aspect ratio). It should feature the product prominently, with expressive, intriguing text and a human element if possible." },
            { name: "Magazine Ad", prompt: "Generate a luxurious, high-fashion style print ad for a glossy magazine. The product should look premium, with elegant lighting and a sophisticated background." },
        ];

        // Populate ad format buttons
        adIdeas.forEach(idea => {
            const button = document.createElement('button');
            button.className = 'ad-button w-full font-bold py-3 px-3 rounded-lg disabled:bg-gray-700 disabled:cursor-not-allowed disabled:text-gray-500';
            button.textContent = idea.name;
            button.disabled = true;
            button.dataset.prompt = idea.prompt;
            button.onclick = () => generateAd(idea.prompt);
            adFormatsContainer.appendChild(button);
        });
        
        const adButtons = adFormatsContainer.querySelectorAll('button');

        // Event Listeners for upload
        uploadArea.addEventListener('click', () => imageUpload.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('upload-area-futuristic:hover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('upload-area-futuristic:hover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('upload-area-futuristic:hover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        imageUpload.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                 // Replace alert with a custom message
                errorMessage.textContent = 'Please upload a valid image file (PNG, JPG, etc.).';
                errorMessage.classList.remove('hidden');
                resultContainer.classList.add('hidden');
                placeholderText.classList.remove('hidden');
                return;
            }
            errorMessage.classList.add('hidden');
            const reader = new FileReader();
            reader.onloadend = () => {
                uploadedImageBase64 = reader.result.split(',')[1];
                uploadedImageType = file.type;
                sourceImage.src = reader.result;
                sourceImageContainer.classList.remove('hidden');
                adButtons.forEach(btn => btn.disabled = false);
            };
            reader.readAsDataURL(file);
        }

        async function generateAd(promptText) {
            if (!uploadedImageBase64) {
                errorMessage.textContent = 'Please upload an image first.';
                errorMessage.classList.remove('hidden');
                return;
            }

            placeholderText.classList.add('hidden');
            resultContainer.classList.remove('hidden');
            loader.classList.remove('hidden');
            imageResultWrapper.classList.add('hidden');
            errorMessage.classList.add('hidden');

            const apiKey = ""; // API key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{
                    parts: [
                        { text: promptText },
                        {
                            inlineData: {
                                mimeType: uploadedImageType,
                                data: uploadedImageBase64
                            }
                        }
                    ]
                }],
                generationConfig: {
                    responseModalities: ['TEXT', 'IMAGE']
                },
            };
            
            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(`API Error: ${error.error.message}`);
                }
                
                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (!base64Data) {
                    throw new Error("No image data found in the API response.");
                }

                const imageUrl = `data:image/png;base64,${base64Data}`;
                generatedImage.src = imageUrl;
                downloadBtn.onclick = () => downloadImage(imageUrl, 'generated-ad.png');

                loader.classList.add('hidden');
                imageResultWrapper.classList.remove('hidden');

            } catch (error) {
                console.error("Error generating ad:", error);
                errorMessage.textContent = `Failed to generate ad. ${error.message}`;
                errorMessage.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        }
        
        // Fetch with exponential backoff
        async function fetchWithRetry(url, options, retries = 3, backoff = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429) { // Not a rate limit error
                        return response;
                    }
                    // It is a rate limit error, wait and retry
                    console.log(`Rate limited. Retrying in ${backoff}ms...`);
                } catch (error) {
                    if (i === retries - 1) throw error; // Rethrow last error
                }
                await new Promise(resolve => setTimeout(resolve, backoff));
                backoff *= 2; // Double the backoff time for the next retry
            }
            throw new Error("Max retries reached");
        }


        function downloadImage(dataUrl, filename) {
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

    </script>
</body>
</html>


